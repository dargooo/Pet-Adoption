<!DOCTYPE html>
<html>
<title>Message</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="../static/css/user.css" rel="stylesheet" media="all">
<link href="./m.css" rel="stylesheet" media="all">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
      integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js"></script>
<style>
	body, h1,h2,h3,h4,h5,h6 {font-family: "Montserrat", sans-serif}
	.w3-row-padding img {margin-bottom: 12px}
	.w3-sidebar {width: 120px;background: #222;}
	#main {margin-left: 120px}
    .cute_font_sm {
        font-family: "Comic Sans MS", "Comic Sans", cursive;
        font-size: 20px;
        color: white;
    }
	.container {
	  border: none;
	  background-color: white;
	  border-radius: 10px;
	  padding: 0;
	  color: #5c5c5c;
	  font-size: 17px;
	}
	.content-table { display: table;  padding:0 20px 0 0; border-collapse: separate; border-spacing: 0 0;}
	.content-row   { display: table-row;}
	.column        { display: table-cell; vertical-align: middle;}
	.darker {
	  border-color: #ccc;
	  background-color: #ddd;
	}
	.container::after {
	  content: "";
	  clear: both;
	  display: table;
	}
	.container img {
	  float: left;
	  max-width: 60px;
	  border-radius: 50%;
	}
	.container img.right {
	  float: right;
	  margin-left: 20px;
	  margin-right:0;
	}
	.time-right {
	  float: right;
	  color: #aaa;
	}
	.time-left {
	  float: left;
	  color: #999;
	}
	.left {
	    text-align: left;
	}
	.right {
	    text-align: right;
	}

</style>

<body style="background-color: rgb(230,249,255);">

<!-- Navbar (sit on top) -->
<div class="w3-top">
    <div class="w3-bar" id="myNavbar">
        <a class="w3-bar-item w3-button w3-hover-black w3-hide-medium w3-hide-large w3-right" href="javascript:void(0);"
           onclick="toggleFunction()" title="Toggle Navigation Menu">
            <i class="fa fa-bars"></i>
        </a>
        <a id="nav-home" href="/home" class="w3-bar-item w3-button"><i class="fa fa-th-large"></i> HOME</a>
        <a id="nav-post" href="/post" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-file-o"></i> POST</a>
        <a id="nav-find" href="/find" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-link"></i> FIND</a>
        <a id="nav-account" href="/login" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-user"></i> ACCOUNT</a>
    </div>
</div>

<!-- ############################# Page Content ############################# -->
<div class="cute_font_sm" style="padding: 20px 80px; border-radius: 10px; margin-top:100px; margin-left:200px; margin-right:200px; background-color: rgb(117, 214, 255);" id="main">

    <div class="w3-padding-32 w3-justify w3-content" id="pad">
        <hr class="horizon-line" style="margin-bottom: 5px;" class="w3-opacity">
        <p style="font-size:25px; margin-bottom: 0px; margin-top:0;">xzw0005</p>
        <hr class="horizon-line" style="margin-top: 5px; margin-bottom: 20px;" class="w3-opacity">

        <div class="card">
            <div class="card-body msg_card_body" id="cb">
                <div class="d-flex justify-content-start mb-4">
                    <div class="img_cont_msg">
                        <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img_msg">
                    </div>
                    <div class="msg_cotainer">
                        Hi, how are you samim?
                        <span class="msg_time">2020-11-31 11:02</span>
                    </div>
                </div>

                <div class="d-flex justify-content-end mb-4">
                    <div class="msg_cotainer_send">
                        Hi Khalid i am good tnx how about you?
                        <span class="msg_time_send">2020-11-31 11:08</span>
                    </div>
                    <div class="img_cont_msg">
                        <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img_msg">
                    </div>
                </div>
            </div>

            <div class="card-foot">
                <div class="input-group">
                    <div class="input-group-append">
                        <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
                    </div>
                    <textarea name="" class="form-control type_msg" placeholder="Type your message..."></textarea>
                    <div class="input-group-append">
                        <span class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<br>
<br>
<br>
<br>
<br>
<script>
    document.getElementById('btn-submit').addEventListener('click', function(){ postReview('{{ username }}'); }, false);
</script>
<script>
        if ("{{ login }}" != "") {
            document.getElementById("nav-home").setAttribute("href", "/home/login/{{ login }}");
            document.getElementById("nav-post").setAttribute("href", "/post/login/{{ login }}");
            document.getElementById("nav-find").setAttribute("href", "/find/login/{{ login }}");
			document.getElementById("nav-account").setAttribute("href", "/userpage/{{ login }}/login/{{ login }}");
        }
</script>

<script>
	function getMessages(username) {
			//var site = 'http://coasttocoast.web.illinois.edu';
			var site = "http://127.0.0.1:5000";
            var url = site + '/messages?username=\"' + username + '\"';
            console.log(url);
            fetch(url)
            .then(res => res.json())
            .then(data => {
                console.log(data);
                data.forEach(obj => {

					if (username == obj.receiver) {
						if (document.getElementById("card-" + obj.sender) == null) {
							var pad = document.createElement("div");
							pad.setAttribute("class", "w3-padding-32 w3-justify w3-content");

							var l1 = document.createElement("hr");
							l1.setAttribute("class", "horizon-line w3-opacityi");
							l1.setAttribute("style", "margin-bottom: 5px;");
							pad.appendChild(l1);

							var p = document.createElement("p");
							p.setAttribute("style", "font-size:25px; margin-bottom: 0px; margin-top:0;");
							p.innerHTML = obj.sender;
							pad.appendChild(p);

							var l2 = document.createElement("hr");
							l2.setAttribute("class", "horizon-line w3-opacityi");
							l2.setAttribute("style", "margin-bottom: 20px; margin-top: 5px;");
							pad.appendChild(l2);

							var card = document.createElement("div");
							card.setAttribute("class", "card");
							var cb = document.createElement("div");
							cb.setAttribute("class", "card-body msg_card_body");
							cb.setAttribute("id", "card-" + obj.sender);
							card.appendChild(cb);
							pad.appendChild(card);
							document.getElementById("main").appendChild(pad);

						}

						var div = document.createElement("div");
						div.setAttribute("class", "d-flex justify-content-start mb-4");

						var img_div = document.createElement("div");
						img_div.setAttribute("class", "img_cont_msg");
						var img = document.createElement("img");
						img.setAttribute("src", "https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg");
						img.setAttribute("class", "rounded-circle user_img_msg");
						img_div.appendChild(img);
						div.appendChild(img_div);

						var msg_div = document.createElement("div");
						msg_div.setAttribute("class", "msg_cotainer");
						msg_div.innerHTML = obj.content;
						var span = document.createElement("span");
						span.setAttribute("class", "msg_time");
						span.innerHTML = obj.time;
						msg_div.appendChild(span);
						div.appendChild(msg_div)

						document.getElementById("card-" + obj.sender).appendChild(div);
					} 
					else {
                        if (document.getElementById("card-" + obj.receiver) == null) {
							var pad = document.createElement("div");
							pad.setAttribute("class", "w3-padding-32 w3-justify w3-content");

							var l1 = document.createElement("hr");
							l1.setAttribute("class", "horizon-line w3-opacityi");
							l1.setAttribute("style", "margin-bottom: 5px;");
							pad.appendChild(l1);

							var p = document.createElement("p");
							p.setAttribute("style", "font-size:25px; margin-bottom: 0px; margin-top:0;");
							p.innerHTML = obj.receiver;
							pad.appendChild(p);

							var l2 = document.createElement("hr");
							l2.setAttribute("class", "horizon-line w3-opacityi");
							l2.setAttribute("style", "margin-bottom: 20px; margin-top: 5px;");
							pad.appendChild(l2);

                            var card = document.createElement("div");
                            card.setAttribute("class", "card");
                            var cb = document.createElement("div");
                            cb.setAttribute("class", "card-body msg_card_body");
                            cb.setAttribute("id", "card-" + obj.receiver);
							card.appendChild(cb);
							pad.appendChild(card);
							document.getElementById("main").appendChild(pad);
                        }

						var div = document.createElement("div");
						div.setAttribute("class", "d-flex justify-content-end mb-4");

						var msg_div = document.createElement("div");
						msg_div.setAttribute("class", "msg_cotainer_send");
						msg_div.innerHTML = obj.content;
						var span = document.createElement("span");
						span.setAttribute("class", "msg_time_send");
						span.innerHTML = obj.time;
						msg_div.appendChild(span);
						div.appendChild(msg_div)

						var img_div = document.createElement("div");
						img_div.setAttribute("class", "img_cont_msg");
						var img = document.createElement("img");
						img.setAttribute("src", "https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg");
						img.setAttribute("class", "rounded-circle user_img_msg");
						img_div.appendChild(img);
						div.appendChild(img_div);

						document.getElementById("card-" + obj.receiver).appendChild(div);
					}

                });
            })
            .catch(error => console.log('ERROR'));
			}
</script>
<script>
</script>
<script>getMessages('ywang14');</script>

</body>
</html>

